<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fly USA Boarding Pass Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Libre+Barcode+128&display=swap');

        :root {
            --printer-width: 80mm;
        }

        body {
            background-color: #f3f4f6;
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s;
        }

        /* LAYOUT 1: THERMAL RECEIPT (Classic) */
        .layout-thermal {
            width: var(--printer-width);
            background: white;
            color: black;
            padding: 5mm;
            box-sizing: border-box;
            border: 1px dashed #ccc;
        }

        /* LAYOUT 2: MODERN CARD (New) */
        .layout-modern {
            width: 120mm;
            background: white;
            color: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #e5e7eb;
            display: flex;
            flex-direction: column;
        }

        .barcode {
            font-family: 'Libre Barcode 128', cursive;
            font-size: 40px;
            line-height: 1;
        }

        .dashed-line {
            border-top: 1px dashed black;
            margin: 10px 0;
        }

        .label {
            font-size: 8pt;
            text-transform: uppercase;
            font-weight: 600;
            color: #666;
        }

        .value {
            font-size: 11pt;
            font-weight: 800;
        }

        /* Printing logic */
        @media print {
            body { background: white !important; }
            .no-print { display: none !important; }
            #print-view { 
                display: block !important; 
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
            }
            @page {
                size: auto;
                margin: 0;
            }
        }

        .page-hidden { display: none !important; }
        .page-visible { display: flex !important; }
    </style>
</head>
<body class="min-h-screen">

    <!-- HOME PAGE SECTION -->
    <div id="home-page" class="p-4 md:p-8 max-w-4xl mx-auto page-visible flex-col no-print">
        <div class="mb-6 bg-white p-6 rounded-2xl shadow-lg border-4 border-blue-500 text-center">
            <h1 class="text-2xl font-black mb-2 uppercase tracking-tight">Bike Route Station</h1>
            <p class="text-gray-600 mb-6">Hit the button or scan a ticket to begin!</p>
            
            <div class="flex justify-center">
                <!-- NEW RIDE BUTTON -->
                <button onclick="goToPrintPage()" class="w-full max-w-md bg-blue-600 hover:bg-blue-700 active:scale-95 text-white text-2xl font-black py-12 rounded-2xl shadow-xl transition-all flex flex-col items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12.2 2h-.4a2 2 0 0 0-2 2v1.2a2 2 0 0 1-1.2 1.8l-1.5.7a2 2 0 0 1-2.4-.7l-.8-1a2 2 0 0 0-2.8-.2l-.3.3a2 2 0 0 0-.2 2.8l1 1a2 2 0 0 1 .7 2.4l-.7 1.5a2 2 0 0 1-1.8 1.2H2.2a2 2 0 0 0-2 2v.4a2 2 0 0 0 2 2h1.2a2 2 0 0 1 1.8 1.2l.7 1.5a2 2 0 0 1-.7 2.4l-1 1a2 2 0 0 0 .2 2.8l.3.3a2 2 0 0 0 2.8-.2l.8-1a2 2 0 0 1 2.4-.7l1.5.7a2 2 0 0 1 1.2 1.8v1.2a2 2 0 0 0 2 2h.4a2 2 0 0 0 2-2v-1.2a2 2 0 0 1 1.2-1.8l1.5-.7a2 2 0 0 1 2.4.7l.8 1a2 2 0 0 0 2.8.2l.3-.3a2 2 0 0 0 2.8-.2l.8-1a2 2 0 0 1 2.4-.7l1.5.7a2 2 0 0 1 1.2 1.8V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    NEW RIDE
                </button>
            </div>

            <div class="mt-6 bg-gray-100 p-4 rounded-xl border-2 border-dashed border-gray-300">
                <p class="text-xs font-bold text-gray-500 uppercase mb-2">General Scanner (Returning Ride)</p>
                <input type="text" id="scanner-input" oninput="handleScan(this.value)" onkeydown="checkInputEnter(event)" placeholder="SCAN RIDE BARCODE..." class="w-full bg-white border border-gray-300 p-3 rounded-lg font-mono text-center text-xl uppercase tracking-widest focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            
            <div class="mt-4 flex justify-between text-xs text-gray-400 font-bold uppercase">
                <button onclick="openSettings()" class="hover:text-blue-600 transition-colors">Ctrl + S: Settings</button>
                <div class="flex items-center gap-4">
                    <span id="idle-warning" class="text-orange-500 hidden animate-pulse">Auto-return soon...</span>
                    <span id="stored-count">0 Rides Logged</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold italic tracking-tight uppercase">Route History</h2>
                    <button onclick="clearHistory()" class="text-[10pt] font-bold text-red-500 hover:text-red-700 uppercase tracking-tighter">Clear All</button>
                </div>
                <div id="logs" class="space-y-2 font-mono text-xs text-gray-500 overflow-y-auto max-h-40">
                    <p>> System ready...</p>
                </div>
            </div>
            <div class="bg-blue-50 p-6 rounded-xl border border-blue-100 flex flex-col items-center justify-center text-blue-600 font-bold text-center italic">
                <p id="status-text">Ready for departure. Start a new ride.</p>
            </div>
        </div>
    </div>

    <!-- PRINT PAGE SECTION -->
    <div id="print-view" class="page-hidden fixed inset-0 bg-white z-[50] flex flex-col items-center justify-center overflow-auto p-4">
        <div class="no-print mb-8 text-center animate-pulse">
            <h2 class="text-2xl font-black text-blue-600 uppercase" id="print-title">Printing Receipt...</h2>
            <p class="text-gray-500">Preparing layout for thermal printer.</p>
        </div>

        <div id="print-area">
            <!-- LAYOUT 1: THERMAL BOARDING PASS -->
            <div id="layout-view-thermal" class="layout-thermal mx-auto hidden">
                <div class="flex justify-between items-center mb-4">
                    <div class="font-black text-xl italic tracking-tighter">FLY USA</div>
                    <div class="text-xs font-bold border border-black px-2 py-0.5 uppercase">Boarding Pass</div>
                </div>
                <div class="dashed-line"></div>
                <div class="mb-4">
                    <div class="label">Passenger</div>
                    <div class="value name-target">---</div>
                </div>
                <div class="flex justify-between mb-4">
                    <div>
                        <div class="label">From</div>
                        <div class="text-2xl font-black from-target">---</div>
                    </div>
                    <div class="flex items-center">‚úà</div>
                    <div class="text-right">
                        <div class="label">To</div>
                        <div class="text-2xl font-black to-target">---</div>
                    </div>
                </div>
                <div class="flex justify-between gap-4 mb-4">
                    <div class="flex-1">
                        <div class="label">Ride ID</div>
                        <div class="value flight-target">US000000000</div>
                    </div>
                    <div class="text-right flex-1">
                        <div class="label">Date</div>
                        <div class="value date-target">-- --- ----</div>
                    </div>
                </div>
                <div class="dashed-line"></div>
                <div class="grid grid-cols-3 gap-2 mb-6 text-center bg-gray-50 p-2">
                    <div><div class="label">Gate</div><div class="value gate-target">--</div></div>
                    <div class="border-x border-gray-200"><div class="label">Bike</div><div class="value seat-target">--</div></div>
                    <div><div class="label">Leaving</div><div class="value time-target">--:--</div></div>
                </div>
                <div class="flex flex-col items-center gap-4">
                    <div class="qr-target bg-white p-1"></div>
                    <div class="barcode text-center barcode-target">US000000000</div>
                </div>
            </div>

            <!-- LAYOUT 2: MODERN CARD -->
            <div id="layout-view-modern" class="layout-modern mx-auto hidden">
                <div class="bg-blue-600 p-4 text-white flex justify-between items-center">
                    <div>
                        <div class="text-xs opacity-80 uppercase font-bold tracking-widest">Official Boarding Pass</div>
                        <div class="text-2xl font-black italic">FLY USA</div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs opacity-80 uppercase font-bold">Ride No.</div>
                        <div class="text-xl font-bold flight-target">US000</div>
                    </div>
                </div>
                <div class="p-6 grid grid-cols-2 gap-6">
                    <div>
                        <div class="mb-4">
                            <div class="label">Passenger Name</div>
                            <div class="text-lg font-bold name-target">---</div>
                        </div>
                        <div class="flex justify-between items-end bg-gray-50 p-3 rounded-lg border border-gray-100">
                            <div>
                                <div class="label">Origin</div>
                                <div class="text-2xl font-black text-blue-600 from-target">---</div>
                            </div>
                            <div class="pb-1 text-gray-300">‚Üí</div>
                            <div class="text-right">
                                <div class="label">Destination</div>
                                <div class="text-2xl font-black text-blue-600 to-target">---</div>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col items-center justify-center border-l border-gray-100 pl-6">
                        <div class="qr-target mb-2"></div>
                        <div class="text-[7pt] font-mono barcode-target">US000</div>
                    </div>
                </div>
                <div class="bg-gray-100 p-4 grid grid-cols-4 gap-2 text-center border-t border-gray-200">
                    <div><div class="label">Gate</div><div class="font-bold gate-target">--</div></div>
                    <div><div class="label">Seat</div><div class="font-bold seat-target">--</div></div>
                    <div><div class="label">Time</div><div class="font-bold time-target">--:--</div></div>
                    <div><div class="label">Date</div><div class="font-bold date-target">--/--</div></div>
                </div>
            </div>
        </div>

        <button onclick="goHome()" class="no-print mt-10 bg-gray-800 text-white px-8 py-3 rounded-full font-bold hover:bg-black transition-colors">
            ‚Üê BACK TO STATION
        </button>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-[100] px-4">
        <div class="bg-white p-8 rounded-2xl max-w-lg w-full shadow-2xl">
            <h3 class="text-2xl font-bold mb-4">Station Settings</h3>
            <div class="mb-6">
                <label class="block text-sm font-bold text-gray-700 mb-2 uppercase tracking-wide">Ticket Layout</label>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="setLayout('thermal')" id="btn-layout-thermal" class="py-3 border-2 rounded-xl font-bold transition-all border-blue-600 bg-blue-50 text-blue-600">Thermal Receipt</button>
                    <button onclick="setLayout('modern')" id="btn-layout-modern" class="py-3 border-2 rounded-xl font-bold transition-all border-gray-200 text-gray-400">Modern Card</button>
                </div>
            </div>
            <div class="mb-6">
                <label class="block text-sm font-bold text-gray-700 mb-2 uppercase tracking-wide">Available Locations</label>
                <textarea id="airport-list" rows="4" class="w-full border p-4 rounded-xl font-mono uppercase tracking-widest text-sm" placeholder="HOME, PARK, SHOP..."></textarea>
            </div>
            <div class="flex gap-2">
                <button onclick="saveSettings()" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold">Save & Close</button>
                <button onclick="closeSettings()" class="bg-gray-200 px-6 py-3 rounded-xl font-bold text-gray-600">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Confirm Clear Modal -->
    <div id="clear-confirm-modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-[110] px-4">
        <div class="bg-white p-6 rounded-2xl max-w-sm w-full shadow-2xl text-center">
            <div class="text-red-500 mb-4 flex justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
            </div>
            <h3 class="text-xl font-bold mb-2 uppercase">Clear History?</h3>
            <p class="text-gray-500 mb-6 text-sm">This will delete all flight records.</p>
            <div class="flex gap-3">
                <button onclick="executeClearHistory()" class="flex-1 bg-red-600 text-white py-3 rounded-xl font-bold">Clear All</button>
                <button onclick="closeClearModal()" class="flex-1 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        const defaultAirports = ["HOME", "PARK", "SHOP", "SCHOOL", "TRAIL", "HILL", "LAKE", "BRIDGE", "CENTER"];
        const names = ["Alex River", "Jamie Smith", "Casey Lane", "Taylor Reed", "Morgan Hill", "Jordan West", "Skyler Blue", "Riley Quinn", "Peyton Ross", "Charlie Day"];

        let currentLayout = localStorage.getItem('flyusa_layout') || 'thermal';
        let qrInstances = [];
        let idleTimer;
        const IDLE_TIME_LIMIT = 5000; // 5 seconds
        const REDIRECT_URL = "https://rubiks13.github.io/bikes/";

        // BANK TIME LOGIC
        function getBankTime() {
            let startTime = localStorage.getItem('sim_bank_start_real_time');
            if (!startTime) {
                startTime = Date.now();
                localStorage.setItem('sim_bank_start_real_time', startTime);
            }
            const elapsedMins = (Date.now() - startTime) / 60000;
            const bankHour = Math.floor(elapsedMins % 24);
            const bankMinute = Math.floor((elapsedMins * 60) % 60);
            const ampm = bankHour >= 12 ? 'PM' : 'AM';
            const displayHour = bankHour % 12 || 12;
            const displayMin = bankMinute.toString().padStart(2, '0');
            return `${displayHour}:${displayMin} ${ampm}`;
        }

        // IDLE REDIRECT LOGIC
        function resetIdleTimer() {
            clearTimeout(idleTimer);
            document.getElementById('idle-warning').classList.add('hidden');
            
            idleTimer = setTimeout(() => {
                const isPrinting = !document.getElementById('print-view').classList.contains('page-hidden');
                const isSettingsOpen = !document.getElementById('settings-modal').classList.contains('hidden');
                
                if (!isPrinting && !isSettingsOpen) {
                    window.location.href = REDIRECT_URL;
                } else {
                    resetIdleTimer();
                }
            }, IDLE_TIME_LIMIT);

            setTimeout(() => {
               if (window.location.href !== REDIRECT_URL) {
                   document.getElementById('idle-warning').classList.remove('hidden');
               }
            }, IDLE_TIME_LIMIT - 1500);
        }

        window.addEventListener('mousemove', resetIdleTimer);
        window.addEventListener('keydown', resetIdleTimer);
        window.addEventListener('touchstart', resetIdleTimer);
        window.addEventListener('mousedown', resetIdleTimer);

        function initQRs() {
            document.querySelectorAll('.qr-target').forEach((el) => {
                qrInstances.push(new QRCode(el, { width: 100, height: 100 }));
            });
        }

        function getFlightDb() {
            const db = localStorage.getItem('flyusa_flights');
            return db ? JSON.parse(db) : {};
        }

        function saveFlightToDb(data) {
            const db = getFlightDb();
            db[data.flight] = { name: data.name, from: data.from, to: data.to, date: data.date, gate: data.gate, seat: data.seat, time: data.time };
            localStorage.setItem('flyusa_flights', JSON.stringify(db));
            updateLogDisplay();
        }

        function handleJobCompletion(data) {
            // 1. Run the print command
            window.print();

            // 2. This code runs AFTER the print window is closed
            setTimeout(() => {
                // Bank Integration
                let currentBal = parseFloat(localStorage.getItem('sim_bank_balance')) || 0;
                let logs = JSON.parse(localStorage.getItem('sim_bank_logs')) || [];

                localStorage.setItem('sim_bank_balance', (currentBal + 5.00).toFixed(2));

                logs.unshift({
                    type: 'Income',
                    amount: 5.00,
                    job: `Pilot: ${data.from} to ${data.to}`, 
                    bankTime: getBankTime(), // Fixes the N/A issue!
                    date: new Date().toLocaleTimeString()
                });
                localStorage.setItem('sim_bank_logs', JSON.stringify(logs));

                // 3. Show visual confirmation
                const alertBox = document.createElement('div');
                alertBox.innerHTML = 'üí∞ $5.00 sent to Bank!';
                alertBox.style = 'position:fixed; top:20px; left:50%; transform:translateX(-50%); background:#2563eb; color:white; padding:15px 30px; border-radius:100px; font-weight:bold; z-index:10000; box-shadow:0 4px 15px rgba(0,0,0,0.3);';
                document.body.appendChild(alertBox);
                
                // Remove message after 4 seconds
                setTimeout(() => alertBox.remove(), 4000);

                // Auto return to home view
                goHome();
            }, 500);
        }

        function removeFlightFromDb(flightId) {
            const db = getFlightDb();
            delete db[flightId];
            localStorage.setItem('flyusa_flights', JSON.stringify(db));
            updateLogDisplay();
        }

        function clearHistory() { document.getElementById('clear-confirm-modal').classList.remove('hidden'); }
        function closeClearModal() { document.getElementById('clear-confirm-modal').classList.add('hidden'); }
        function executeClearHistory() {
            localStorage.removeItem('flyusa_flights');
            updateLogDisplay();
            addLog("Route history cleared.");
            closeClearModal();
        }

        function updateLogDisplay() {
            const db = getFlightDb();
            const count = Object.keys(db).length;
            document.getElementById('stored-count').textContent = `${count} Rides Logged`;
            const logs = document.getElementById('logs');
            logs.innerHTML = '';
            const keys = Object.keys(db);
            if (keys.length === 0) {
                logs.innerHTML = '<p>> No records found.</p>';
            } else {
                keys.slice(-10).reverse().forEach(id => {
                    const p = document.createElement('p');
                    p.textContent = `> ${id}: ${db[id].from} -> ${db[id].to}`;
                    logs.appendChild(p);
                });
            }
        }

        function handleScan(value) {
            const db = getFlightDb();
            const cleanVal = value.trim().toUpperCase();
            if (db[cleanVal]) {
                const oldFlight = db[cleanVal];
                addLog(`Recognized ${cleanVal}. Returning...`);
                const nextRide = generateRandomRide(oldFlight.to, null, oldFlight.from, oldFlight.name);
                removeFlightFromDb(cleanVal);
                document.getElementById('scanner-input').value = '';
                populateTicket(nextRide);
                executePrintSequence(nextRide);
            }
        }

        function checkInputEnter(event) {
            if (event.key === "Enter" && event.target.value.trim() === "") {
                goToPrintPage();
            }
        }

        function addLog(msg) {
            const logs = document.getElementById('logs');
            const p = document.createElement('p');
            p.textContent = `> ${msg}`;
            logs.prepend(p);
        }

        function goToPrintPage() {
            const data = generateRandomRide();
            populateTicket(data);
            executePrintSequence(data);
        }

        function executePrintSequence(data) {
            saveFlightToDb(data);
            
            document.getElementById('home-page').classList.replace('page-visible', 'page-hidden');
            document.getElementById('print-view').classList.replace('page-hidden', 'page-visible');
            document.body.style.backgroundColor = "white";

            document.getElementById('layout-view-thermal').classList.add('hidden');
            document.getElementById('layout-view-modern').classList.add('hidden');

            document.getElementById('print-title').textContent = "Printing Boarding Pass...";
            if (currentLayout === 'thermal') {
                document.getElementById('layout-view-thermal').classList.remove('hidden');
            } else {
                document.getElementById('layout-view-modern').classList.remove('hidden');
            }

            // Trigger the job completion flow
            setTimeout(() => {
                handleJobCompletion(data);
            }, 500);
        }

        function goHome() {
            document.getElementById('print-view').classList.replace('page-visible', 'page-hidden');
            document.getElementById('home-page').classList.replace('page-hidden', 'page-visible');
            document.body.style.backgroundColor = "#f3f4f6";
            setTimeout(() => { document.getElementById('scanner-input').focus(); }, 100);
            resetIdleTimer();
        }

        function generateRandomRide(customFrom = null, customName = null, restrictedTo = null, restrictedName = null) {
            const pool = getAirports();
            let from = customFrom || pool[Math.floor(Math.random() * pool.length)];
            let to;
            do { to = pool[Math.floor(Math.random() * pool.length)]; } while (to === from || (restrictedTo && to === restrictedTo));
            let selectedName = customName || names[Math.floor(Math.random() * names.length)].toUpperCase();
            const now = new Date();
            return {
                name: selectedName,
                flight: "US" + Math.floor(100000000 + Math.random() * 900000000),
                from, to,
                gate: String.fromCharCode(65 + Math.floor(Math.random() * 4)) + Math.floor(Math.random() * 9 + 1),
                seat: (Math.floor(Math.random() * 12) + 1) + "B",
                time: String(now.getHours()).padStart(2, '0') + ":" + String(now.getMinutes()).padStart(2, '0'),
                date: now.toLocaleDateString('en-GB', { day: '2-digit', month: 'short' }).toUpperCase()
            };
        }

        function populateTicket(data) {
            document.querySelectorAll('.name-target').forEach(el => el.textContent = data.name);
            document.querySelectorAll('.from-target').forEach(el => el.textContent = data.from);
            document.querySelectorAll('.to-target').forEach(el => el.textContent = data.to);
            document.querySelectorAll('.flight-target').forEach(el => el.textContent = data.flight);
            document.querySelectorAll('.date-target').forEach(el => el.textContent = data.date);
            document.querySelectorAll('.gate-target').forEach(el => el.textContent = data.gate);
            document.querySelectorAll('.seat-target').forEach(el => el.textContent = data.seat);
            document.querySelectorAll('.time-target').forEach(el => el.textContent = data.time);
            document.querySelectorAll('.barcode-target').forEach(el => el.textContent = data.flight);
            qrInstances.forEach(inst => {
                inst.clear();
                inst.makeCode(data.flight);
            });
        }

        function setLayout(type) {
            currentLayout = type;
            document.getElementById('btn-layout-thermal').className = type === 'thermal' ? 'py-3 border-2 rounded-xl font-bold border-blue-600 bg-blue-50 text-blue-600' : 'py-3 border-2 rounded-xl font-bold border-gray-200 text-gray-400';
            document.getElementById('btn-layout-modern').className = type === 'modern' ? 'py-3 border-2 rounded-xl font-bold border-blue-600 bg-blue-50 text-blue-600' : 'py-3 border-2 rounded-xl font-bold border-gray-200 text-gray-400';
        }

        window.addEventListener('keydown', (e) => { 
            if (e.ctrlKey && e.key === 's') { e.preventDefault(); openSettings(); } 
        });
        
        function openSettings() {
            const list = localStorage.getItem('flyusa_airports') || defaultAirports.join(", ");
            document.getElementById('airport-list').value = list;
            setLayout(currentLayout);
            document.getElementById('settings-modal').classList.remove('hidden');
        }
        function closeSettings() { 
            document.getElementById('settings-modal').classList.add('hidden');
            resetIdleTimer();
        }
        function saveSettings() {
            localStorage.setItem('flyusa_airports', document.getElementById('airport-list').value);
            localStorage.setItem('flyusa_layout', currentLayout);
            closeSettings();
        }
        function getAirports() {
            const stored = localStorage.getItem('flyusa_airports');
            return stored ? stored.split(',').map(s => s.trim().toUpperCase()).filter(s => s.length > 0) : defaultAirports;
        }

        window.onload = () => {
            initQRs();
            updateLogDisplay();
            document.getElementById('scanner-input').focus();
            resetIdleTimer();
        };
    </script>
</body>
</html>
