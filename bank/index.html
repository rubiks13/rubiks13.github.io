<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bike Bank | Future of Cycling Finance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --brand-primary: #0ea5e9;
            --bg-dark: #020617;
            --card-bg: rgba(15, 23, 42, 0.6);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-dark);
            color: #f8fafc;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(14, 165, 233, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 100% 100%, rgba(99, 102, 241, 0.1) 0%, transparent 40%);
        }

        .glass-panel {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .gradient-brand {
            background: linear-gradient(135deg, #0ea5e9, #6366f1);
        }

        .nav-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .nav-item.active {
            background: rgba(14, 165, 233, 0.15);
            color: #0ea5e9;
            box-shadow: inset 4px 0 0 #0ea5e9;
        }

        @keyframes pulse-ring {
            0% { transform: scale(.33); opacity: 1; }
            80%, 100% { opacity: 0; }
        }

        .status-dot {
            position: relative;
            width: 8px;
            height: 8px;
            background-color: #10b981;
            border-radius: 50%;
        }
        .status-dot::after {
            content: '';
            position: absolute;
            top: -4px; left: -4px; right: -4px; bottom: -4px;
            border: 2px solid #10b981;
            border-radius: 50%;
            animation: pulse-ring 1.5s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="w-full h-20 glass-panel border-b border-white/5 px-6 flex justify-between items-center sticky top-0 z-[60]">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 gradient-brand rounded-xl flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
            </div>
            <div>
                <h1 class="font-extrabold text-lg tracking-tight leading-none">BIKE BANK</h1>
                <span class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Global Ledger V3</span>
            </div>
        </div>

        <div class="flex items-center gap-4">
            <div class="hidden md:flex items-center gap-2 bg-slate-900/80 px-4 py-2 rounded-full border border-white/5">
                <div class="status-dot"></div>
                <span class="text-[10px] font-bold text-slate-400 tracking-widest">RECEIVING PORT: ACTIVE</span>
            </div>
            <div class="bg-slate-800 px-4 py-2 rounded-xl font-mono text-blue-400 font-bold border border-blue-500/20" id="bike-time-display">00:00</div>
        </div>
    </header>

    <div class="flex flex-1">
        <nav class="w-20 lg:w-72 glass-panel border-r border-white/5 flex flex-col sticky top-20 h-[calc(100vh-80px)]">
            <div class="flex-1 py-6 flex flex-col gap-1">
                <button onclick="switchTab('dashboard')" class="nav-item mx-3 p-4 rounded-2xl flex items-center gap-4 hover:bg-white/5 active" id="tab-btn-dashboard">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                    <span class="hidden lg:inline font-semibold">Dashboard</span>
                </button>
                <button onclick="switchTab('activity')" class="nav-item mx-3 p-4 rounded-2xl flex items-center gap-4 hover:bg-white/5" id="tab-btn-activity">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    <span class="hidden lg:inline font-semibold">History</span>
                </button>
                <button onclick="switchTab('dev')" class="nav-item mx-3 p-4 rounded-2xl flex items-center gap-4 hover:bg-white/5" id="tab-btn-dev">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>
                    <span class="hidden lg:inline font-semibold">Integrations</span>
                </button>
            </div>
            <div class="p-6 text-center opacity-50 text-[10px] font-bold">AUTO-LOG: 10S</div>
        </nav>

        <main class="flex-1 p-6 lg:p-12 overflow-y-auto">
            
            <!-- Dashboard -->
            <section id="tab-dashboard" class="max-w-4xl mx-auto space-y-8">
                <div class="glass-panel rounded-[40px] p-10 relative overflow-hidden">
                    <div class="relative z-10">
                        <p class="text-slate-400 font-bold text-xs uppercase tracking-[0.2em] mb-2">Total Bike Credits</p>
                        <h2 id="balance-display" class="text-7xl font-black tracking-tighter mb-8">$0.00</h2>
                        
                        <div class="flex flex-wrap gap-4">
                            <div class="bg-blue-500/10 border border-blue-500/20 px-4 py-2 rounded-xl flex items-center gap-2">
                                <span class="text-blue-400 font-bold text-xs uppercase" id="user-name-display">USER</span>
                            </div>
                            <button onclick="copyAiPrompt()" class="bg-white text-black px-6 py-2 rounded-xl font-bold text-xs uppercase hover:bg-slate-200 transition-all flex items-center gap-2">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"/><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"/></svg>
                                Copy AI Instructions
                            </button>
                        </div>
                    </div>
                    <div class="absolute -right-20 -bottom-20 w-80 h-80 gradient-brand rounded-full blur-[120px] opacity-20"></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass-panel p-8 rounded-3xl">
                        <h3 class="text-slate-500 text-[10px] font-black uppercase tracking-widest mb-4">Latest Receipt</h3>
                        <div id="last-activity-preview" class="text-2xl font-bold text-green-400">Waiting for data...</div>
                    </div>
                    <div class="glass-panel p-8 rounded-3xl">
                        <h3 class="text-slate-500 text-[10px] font-black uppercase tracking-widest mb-4">Network Status</h3>
                        <div class="flex items-center gap-2 text-blue-400 font-bold">
                            <span class="w-2 h-2 rounded-full bg-blue-500 animate-ping"></span>
                            Synched with Grid
                        </div>
                    </div>
                </div>
            </section>

            <!-- Activity -->
            <section id="tab-activity" class="max-w-2xl mx-auto hidden space-y-4">
                <h2 class="text-2xl font-black uppercase tracking-tight mb-8">Financial Log</h2>
                <div id="activity-list" class="space-y-3"></div>
            </section>

            <!-- Integrations (Developer) -->
            <section id="tab-dev" class="max-w-2xl mx-auto hidden space-y-6">
                <div class="glass-panel p-8 rounded-3xl">
                    <h2 class="text-xl font-black mb-2 uppercase">How to send money here</h2>
                    <p class="text-slate-400 text-sm mb-6">If your other games are not sending money, it is because they don't have the correct URL. Copy the message below and give it to the AI building your other system.</p>
                    
                    <div class="bg-black/50 p-6 rounded-2xl border border-white/10 font-mono text-xs text-blue-300 whitespace-pre-wrap mb-6" id="dev-prompt-text">
                        <!-- Loaded via JS -->
                    </div>
                    
                    <button onclick="copyAiPrompt()" class="w-full gradient-brand py-4 rounded-xl font-black uppercase tracking-widest text-sm shadow-lg shadow-blue-500/20">Copy Instruction Message</button>
                </div>
            </section>

        </main>
    </div>

    <!-- Registration -->
    <div id="registration-modal" class="fixed inset-0 z-[100] flex items-center justify-center bg-slate-950/95 backdrop-blur-md hidden">
        <div class="glass-panel p-10 rounded-[40px] w-full max-w-md text-center">
            <h2 class="text-3xl font-black mb-8 uppercase">Create Identity</h2>
            <input type="text" id="new-user-name" placeholder="YOUR NAME" class="w-full bg-slate-900 border border-white/10 rounded-2xl px-6 py-5 mb-6 text-white font-bold text-center">
            <button onclick="createNewAccount()" class="w-full gradient-brand py-5 rounded-2xl font-black">LOGIN TO BANK</button>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-white text-black px-8 py-3 rounded-full shadow-2xl transition-all duration-500 opacity-0 translate-y-10 pointer-events-none font-bold text-xs uppercase tracking-widest">
        <span id="toast-message"></span>
    </div>

    <script>
        const STORAGE_KEY = "bike_bank_v2_accounts";
        const TIME_STORAGE_KEY = "sim_current_bike_time";
        
        let currentUser = null;
        let accounts = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

        function init() {
            const params = new URLSearchParams(window.location.search);
            const userName = params.get('user');

            if (!userName) {
                document.getElementById('registration-modal').classList.remove('hidden');
            } else {
                currentUser = userName.toLowerCase();
                if (!accounts[currentUser]) {
                    accounts[currentUser] = { name: userName, balance: 0, activity: [] };
                }
                
                checkIncomingFunds();
                renderAll();
                updateDevPrompt();
            }

            setInterval(() => {
                const time = localStorage.getItem(TIME_STORAGE_KEY) || "00:00:00";
                document.getElementById('bike-time-display').innerText = time.substring(0, 5);
            }, 1000);

            // Idle redirect after 15s
            let idle;
            const reset = () => {
                clearTimeout(idle);
                idle = setTimeout(() => window.location.href = "https://rubiks13.github.io/bikes/", 15000);
            };
            window.onload = reset;
            document.onmousemove = reset;
        }

        function checkIncomingFunds() {
            const params = new URLSearchParams(window.location.search);
            const amount = parseFloat(params.get('amount'));
            
            if (!isNaN(amount) && amount !== 0) {
                // Clear URL to prevent re-adding on refresh
                const newUrl = window.location.origin + window.location.pathname + `?user=${currentUser}`;
                window.history.replaceState({}, '', newUrl);

                accounts[currentUser].balance += amount;
                accounts[currentUser].activity.unshift({
                    type: amount > 0 ? "EXTERNAL DEPOSIT" : "EXTERNAL PAYMENT",
                    amount: amount,
                    date: new Date().toLocaleTimeString()
                });
                
                saveData();
                showToast(`RECEIVING $${Math.abs(amount).toFixed(2)}`);
            }
        }

        function renderAll() {
            const user = accounts[currentUser];
            document.getElementById('balance-display').innerText = `$${user.balance.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            document.getElementById('user-name-display').innerText = user.name;
            
            if (user.activity.length > 0) {
                const last = user.activity[0];
                document.getElementById('last-activity-preview').innerText = `${last.amount > 0 ? '+' : '-'}$${Math.abs(last.amount).toFixed(2)}`;
                document.getElementById('last-activity-preview').className = `text-2xl font-bold ${last.amount > 0 ? 'text-green-400' : 'text-red-400'}`;
            }

            const list = document.getElementById('activity-list');
            list.innerHTML = user.activity.map(a => `
                <div class="glass-panel p-5 rounded-2xl flex justify-between items-center">
                    <div>
                        <p class="font-black text-xs uppercase opacity-80">${a.type}</p>
                        <p class="text-[9px] text-slate-500 font-bold uppercase">${a.date}</p>
                    </div>
                    <span class="font-mono font-black text-lg ${a.amount >= 0 ? 'text-green-400' : 'text-red-400'}">
                        ${a.amount >= 0 ? '+' : '-'}$${Math.abs(a.amount).toFixed(2)}
                    </span>
                </div>
            `).join('');
        }

        function updateDevPrompt() {
            const baseUrl = window.location.href.split('?')[0];
            const prompt = `I need you to update my code to send money to my bank. 

When the player [wins/earns money], redirect them to this URL:
${baseUrl}?user=${currentUser}&amount=[NUMBER]

Replace [NUMBER] with the actual amount earned. Make sure the 'user' parameter is exactly '${currentUser}'.`;
            
            document.getElementById('dev-prompt-text').innerText = prompt;
        }

        function copyAiPrompt() {
            const text = document.getElementById('dev-prompt-text').innerText;
            navigator.clipboard.writeText(text).then(() => {
                showToast("INSTRUCTIONS COPIED");
            });
        }

        function switchTab(tabId) {
            document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-btn-${tabId}`).classList.add('active');
        }

        function createNewAccount() {
            const name = document.getElementById('new-user-name').value.trim();
            if (!name) return;
            window.location.href = `?user=${encodeURIComponent(name)}`;
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(accounts));
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-message').innerText = msg;
            t.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => t.classList.add('opacity-0', 'translate-y-10'), 3000);
        }

        window.onload = init;
    </script>
</body>
</html>
