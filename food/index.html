<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Receipt Generator</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define a custom font for the receipt */
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');

        /* Custom styles for the 80mm receipt width */
        .receipt-container {
            width: 80mm; /* Standard thermal receipt width */
            background-color: #ffffff;
            color: #000000;
            font-family: 'Roboto Mono', monospace; /* Monospaced font for that thermal look */
            font-size: 10px;
            padding: 10px;
            margin: 20px auto;
            border: 1px dashed #ccc; /* Border to show the edge on screen */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        
        /* Style for action buttons (Edit/Delete) */
        .action-btn {
            @apply p-1 rounded hover:bg-gray-200 text-gray-500 transition duration-150;
        }

        /* Print-specific styles */
        @media print {
            /* Hide the main UI and only show the receipt */
            #main-ui {
                display: none !important;
            }
            #receipt-output {
                display: block !important;
            }
            body {
                /* Reset margins and padding for printing */
                margin: 0;
                padding: 0;
            }
            .receipt-container {
                /* Ensure no border/shadow appears on the actual printout */
                border: none;
                box-shadow: none;
                width: 80mm;
                margin: 0;
                padding: 0;
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen font-sans">

    <div id="main-ui" class="flex-grow container mx-auto p-4 md:p-8">
        <div class="max-w-xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-2xl">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Custom Receipt Generator</h1>
            <p class="text-gray-600 mb-8">Manage your custom addresses and restaurants below, then click a restaurant button to generate an order!</p>

            <!-- Feedback message (instead of alert) -->
            <div id="error-message" class="hidden text-sm border-2 rounded-lg text-gray-800 border-indigo-400 bg-indigo-100 p-2 text-center mb-6"></div>

            <!-- --- 1. Address Manager Section --- -->
            <div class="mb-8 p-4 bg-indigo-50 rounded-lg border-indigo-200 border">
                <h2 class="text-xl font-semibold text-indigo-700 mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.727A8 8 0 016.343 3.273L4 5h16l-2.343-2.273zM12 18v-6m0 0l-2-2m2 2l2-2" /></svg>
                    1. Delivery Address Manager (Randomly Picked)
                </h2>

                <!-- Input and Save -->
                <div class="flex space-x-2 mb-4">
                    <input type="text" id="new-address-input" placeholder="Enter a new delivery address" class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    <button onclick="saveAddress()" class="px-4 py-2 bg-indigo-500 text-white font-medium rounded-lg hover:bg-indigo-600 transition duration-150 shadow-md flex-shrink-0">
                        Save Address
                    </button>
                </div>
                
                <!-- Saved Addresses List -->
                <div id="saved-addresses-list" class="space-y-2 mt-4 max-h-40 overflow-y-auto p-1 bg-white rounded-lg border border-gray-200">
                    <!-- Addresses will be injected here -->
                </div>
            </div>

            <!-- --- 2. Restaurant Manager Section --- -->
            <div class="mb-8 p-4 bg-purple-50 rounded-lg border-purple-200 border">
                <h2 class="text-xl font-semibold text-purple-700 mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
                    2. Custom Restaurant Manager
                </h2>

                <!-- Input and Save -->
                <div class="flex space-x-2 mb-4">
                    <input type="text" id="new-restaurant-input" placeholder="Enter a custom restaurant name" class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500">
                    <button onclick="saveCustomRestaurant()" class="px-4 py-2 bg-purple-500 text-white font-medium rounded-lg hover:bg-purple-600 transition duration-150 shadow-md flex-shrink-0">
                        Save Restaurant
                    </button>
                </div>
                
                <!-- Saved Restaurants List -->
                <div id="custom-restaurants-list" class="space-y-2 mt-4 max-h-40 overflow-y-auto p-1 bg-white rounded-lg border border-gray-200">
                    <!-- Custom restaurants will be injected here -->
                </div>
            </div>

            <!-- --- 3. Restaurant Selector Section --- -->
            <div id="options-container" class="space-y-4">
                <h2 class="text-xl font-semibold text-indigo-600 mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                    3. Click to Order (Uses Saved Restaurants):
                </h2>
                <!-- Restaurant buttons will be injected here -->
            </div>
        </div>
    </div>

    <!-- The receipt area - Hidden by default, only shown on print -->
    <div id="receipt-output" class="hidden">
        <div id="receipt-content" class="receipt-container">
            <!-- Receipt HTML will be injected here -->
        </div>
    </div>

    <script>
        // Default (seed) restaurant names and items (used if custom lists are empty)
        const defaultFastFoodNames = [
            "Burger Blast", "Taco Titan", "Waffle Wizard", "Pizza Portal"
        ];
        
        const menuItems = [
            { name: "Super Burger Deluxe", price: 12.99 },
            { name: "Crispy Chicken Sandwich", price: 9.50 },
            { name: "Loaded Chili Cheese Fries", price: 6.75 },
            { name: "Milkshake (Vanilla)", price: 4.50 },
            { name: "Jumbo Soft Taco", price: 3.25 },
            { name: "Large Soda", price: 2.50 },
            { name: "Spicy Wing Basket", price: 11.25 },
            { name: "Onion Rings", price: 5.00 },
            { name: "Chocolate Chip Cookie", price: 1.50 },
            { name: "Water Bottle", price: 1.00 },
        ];

        const driverNames = [
            "Mia A.", "Ethan R.", "Sophie L.", "Liam K.", "Chloe B.", "Noah P."
        ];

        // Local Storage Keys
        const ADDRESS_KEY = 'savedAddresses';
        const RESTAURANT_KEY = 'customRestaurants';
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        // State variables
        let addresses = [];
        let customRestaurants = [];

        // --- Helper Functions ---
        const getRandomElement = (arr) => arr[Math.floor(Math.random() * arr.length)];
        const getRandomFloat = (min, max) => (Math.random() * (max - min) + min).toFixed(2);
        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        
        /**
         * Displays a temporary message to the user.
         */
        function showTemporaryMessage(message, className) {
            const messageBox = document.getElementById('error-message');
            messageBox.textContent = message;
            messageBox.className = `mt-4 p-3 border-2 rounded-lg font-medium text-center transition duration-300 ${className}`;
            messageBox.classList.remove('hidden');
            setTimeout(() => messageBox.classList.add('hidden'), 5000);
        }

        // --- Local Storage Sync ---

        function saveStateToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error(`Error saving ${key} to local storage:`, e);
                showTemporaryMessage("Failed to save data due to browser storage issue.", 'text-red-800 border-red-400 bg-red-100');
            }
        }

        function loadStateFromLocalStorage(key) {
            try {
                const stored = localStorage.getItem(key);
                return stored ? JSON.parse(stored) : [];
            } catch (e) {
                console.error(`Error loading ${key} from local storage:`, e);
                return [];
            }
        }

        // --- Address Management (CRUD) ---

        function loadAddresses() {
            addresses = loadStateFromLocalStorage(ADDRESS_KEY);
             // NEW: Add a default address if the list is empty on load
            if (addresses.length === 0) {
                 addresses.push({
                    id: Date.now().toString() + Math.random(), 
                    text: "100 Fictional Rd, Test City, USA", 
                    isEditing: false
                 });
                 saveStateToLocalStorage(ADDRESS_KEY, addresses);
            }
            renderAddressOptions();
        }

        window.saveAddress = function(editId) {
            const input = document.getElementById(editId ? `address-input-${editId}` : 'new-address-input');
            const addressText = input.value.trim();
            
            if (!addressText) {
                showTemporaryMessage("Please enter a valid address.", 'text-red-800 border-red-400 bg-red-100');
                return;
            }

            if (editId) {
                // Update existing
                const index = addresses.findIndex(a => a.id === editId);
                if (index > -1) {
                    addresses[index].text = addressText;
                    addresses[index].isEditing = false; // Stop editing after save
                    saveStateToLocalStorage(ADDRESS_KEY, addresses);
                    showTemporaryMessage("Address updated!", 'text-green-800 border-green-400 bg-green-100');
                }
            } else {
                // Add new
                const newAddress = {
                    id: Date.now().toString(),
                    text: addressText,
                    isEditing: false
                };
                addresses.push(newAddress);
                saveStateToLocalStorage(ADDRESS_KEY, addresses);
                showTemporaryMessage("Address saved! One will be chosen randomly.", 'text-green-800 border-green-400 bg-green-100');
            }
            if (!editId) {
                input.value = ''; // Clear input only for new additions
            }
            renderAddressOptions();
        }

        window.deleteAddress = function(id) {
            // Note: window.confirm is used here as it's a critical deletion, following the original pattern,
            // but in a real app, a modal/dialog would be preferred.
            if (addresses.length <= 1) {
                if (!window.confirm("This is your last address. Are you sure you want to delete it? A default one will be restored on next load.")) {
                    return;
                }
            } else {
                if (!window.confirm("Are you sure you want to delete this address?")) {
                    return;
                }
            }

            addresses = addresses.filter(a => a.id !== id);
            saveStateToLocalStorage(ADDRESS_KEY, addresses);
            renderAddressOptions();
            showTemporaryMessage("Address deleted.", 'text-red-800 border-red-400 bg-red-100');
        }

        window.startEditAddress = function(id) {
            addresses = addresses.map(a => ({
                ...a,
                isEditing: a.id === id ? true : false // Only set one item to editing mode
            }));
            renderAddressOptions();
            // Focus the input field after render
            setTimeout(() => {
                const input = document.getElementById(`address-input-${id}`);
                if (input) input.focus();
            }, 0);
        }

        window.cancelEditAddress = function() {
             addresses = addresses.map(a => ({ ...a, isEditing: false }));
             renderAddressOptions();
        }

        /**
         * Renders the list of saved addresses with edit/delete controls.
         */
        function renderAddressOptions() {
            const container = document.getElementById('saved-addresses-list');
            container.innerHTML = '';
            
            if (addresses.length === 0) {
                container.innerHTML = '<p class="text-sm text-gray-500 italic p-3 text-center">No saved addresses yet. Save one above!</p>';
                return;
            }

            addresses.forEach(addr => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between p-2 border-b border-gray-100 last:border-b-0";

                if (addr.isEditing) {
                    div.innerHTML = `
                        <input type="text" id="address-input-${addr.id}" value="${addr.text}" class="flex-grow p-1 text-sm border rounded focus:ring-indigo-500 focus:border-indigo-500 mr-2" onkeyup="if(event.key==='Enter') saveAddress('${addr.id}')">
                        <button onclick="saveAddress('${addr.id}')" class="px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 mr-1">Save</button>
                        <button onclick="cancelEditAddress()" class="px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500">Cancel</button>
                    `;
                } else {
                    div.innerHTML = `
                        <span class="text-sm text-gray-800 truncate">${addr.text}</span>
                        <div class="flex space-x-1 flex-shrink-0">
                            <button onclick="startEditAddress('${addr.id}')" class="action-btn" title="Edit">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
                            </button>
                            <button onclick="deleteAddress('${addr.id}')" class="action-btn hover:text-red-500" title="Delete">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            </button>
                        </div>
                    `;
                }
                container.appendChild(div);
            });
        }


        // --- Restaurant Management (CRUD) ---

        function loadCustomRestaurants() {
            customRestaurants = loadStateFromLocalStorage(RESTAURANT_KEY);
            // If no custom restaurants exist, seed with defaults for first-time use
            if (customRestaurants.length === 0) {
                 defaultFastFoodNames.forEach(name => {
                    customRestaurants.push({ id: Date.now().toString() + Math.random(), name: name, isEditing: false });
                 });
                 saveStateToLocalStorage(RESTAURANT_KEY, customRestaurants);
            }
            renderCustomRestaurantOptions();
            generateNameOptions(); // Update buttons
        }

        window.saveCustomRestaurant = function(editId) {
            const input = document.getElementById(editId ? `restaurant-input-${editId}` : 'new-restaurant-input');
            const nameText = input.value.trim();
            
            if (!nameText) {
                showTemporaryMessage("Please enter a valid restaurant name.", 'text-red-800 border-red-400 bg-red-100');
                return;
            }

            if (editId) {
                // Update existing
                const index = customRestaurants.findIndex(r => r.id === editId);
                if (index > -1) {
                    customRestaurants[index].name = nameText;
                    customRestaurants[index].isEditing = false; // Stop editing after save
                    saveStateToLocalStorage(RESTAURANT_KEY, customRestaurants);
                    showTemporaryMessage("Restaurant name updated!", 'text-green-800 border-green-400 bg-green-100');
                }
            } else {
                // Add new
                const newRestaurant = {
                    id: Date.now().toString(),
                    name: nameText,
                    isEditing: false
                };
                customRestaurants.push(newRestaurant);
                saveStateToLocalStorage(RESTAURANT_KEY, customRestaurants);
                showTemporaryMessage(`Restaurant "${nameText}" saved!`, 'text-green-800 border-green-400 bg-green-100');
            }
            if (!editId) {
                input.value = '';
            }
            renderCustomRestaurantOptions();
            generateNameOptions(); // Update buttons
        }

        window.deleteRestaurant = function(id) {
             // Note: window.confirm is used here as it's a critical deletion, following the original pattern,
            // but in a real app, a modal/dialog would be preferred.
            if (customRestaurants.length <= 1) {
                 if (!window.confirm("This is your last restaurant. Are you sure you want to delete it? A default list will be restored on next load.")) {
                    return;
                }
            } else {
                 if (!window.confirm("Are you sure you want to delete this restaurant?")) {
                    return;
                }
            }
           
            customRestaurants = customRestaurants.filter(r => r.id !== id);
            saveStateToLocalStorage(RESTAURANT_KEY, customRestaurants);
            renderCustomRestaurantOptions();
            generateNameOptions(); // Update buttons
            showTemporaryMessage("Restaurant deleted.", 'text-red-800 border-red-400 bg-red-100');
        }

        window.startEditRestaurant = function(id) {
            customRestaurants = customRestaurants.map(r => ({
                ...r,
                isEditing: r.id === id ? true : false // Only set one item to editing mode
            }));
            renderCustomRestaurantOptions();
            // Focus the input field after render
            setTimeout(() => {
                const input = document.getElementById(`restaurant-input-${id}`);
                if (input) input.focus();
            }, 0);
        }
        
        window.cancelEditRestaurant = function() {
             customRestaurants = customRestaurants.map(r => ({ ...r, isEditing: false }));
             renderCustomRestaurantOptions();
             generateNameOptions();
        }

        /**
         * Renders the list of saved custom restaurants with edit/delete controls.
         */
        function renderCustomRestaurantOptions() {
            const container = document.getElementById('custom-restaurants-list');
            container.innerHTML = '';
            
            if (customRestaurants.length === 0) {
                container.innerHTML = '<p class="text-sm text-gray-500 italic p-3 text-center">No saved restaurants. Please add one!</p>';
                return;
            }

            customRestaurants.forEach(restaurant => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between p-2 border-b border-gray-100 last:border-b-0";

                if (restaurant.isEditing) {
                    div.innerHTML = `
                        <input type="text" id="restaurant-input-${restaurant.id}" value="${restaurant.name}" class="flex-grow p-1 text-sm border rounded focus:ring-purple-500 focus:border-purple-500 mr-2" onkeyup="if(event.key==='Enter') saveCustomRestaurant('${restaurant.id}')">
                        <button onclick="saveCustomRestaurant('${restaurant.id}')" class="px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 mr-1">Save</button>
                        <button onclick="cancelEditRestaurant()" class="px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500">Cancel</button>
                    `;
                } else {
                    div.innerHTML = `
                        <span class="text-sm text-gray-800 truncate">${restaurant.name}</span>
                        <div class="flex space-x-1 flex-shrink-0">
                            <button onclick="startEditRestaurant('${restaurant.id}')" class="action-btn" title="Edit">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
                            </button>
                            <button onclick="deleteRestaurant('${restaurant.id}')" class="action-btn hover:text-red-500" title="Delete">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            </button>
                        </div>
                    `;
                }
                container.appendChild(div);
            });
        }

        // --- Restaurant Selection Buttons ---

        /**
         * Renders buttons for all custom restaurants.
         */
        window.generateNameOptions = function() {
            const container = document.getElementById('options-container');
            // Clear only the buttons, keep the heading
            let currentButton = container.lastElementChild;
            while (currentButton && currentButton.tagName === 'BUTTON') {
                currentButton.remove();
                currentButton = container.lastElementChild;
            }
            
            if (customRestaurants.length === 0) {
                const message = document.createElement('p');
                message.className = 'text-center text-red-500 font-medium p-4 border border-red-300 rounded-lg';
                message.textContent = 'Please add a restaurant in the manager section above to create an order.';
                container.appendChild(message);
                return;
            }

            customRestaurants.forEach(restaurant => {
                const button = document.createElement('button');
                button.textContent = restaurant.name;
                button.className = "w-full py-4 px-4 text-white font-bold bg-indigo-500 rounded-lg shadow-lg hover:bg-indigo-600 active:translate-y-0.5 transition duration-150 transform tracking-wider text-lg";
                button.onclick = () => handleSelection(restaurant.name);
                container.appendChild(button);
            });
        }

        /**
         * Generates the detailed receipt content as HTML string.
         */
        function generateReceipt(restaurantName, deliveryAddress) {
            const taxRate = 0.0825; // Example tax rate

            let subtotal = 0;
            
            // Calculate a random subtotal (needed for realistic total)
            const numItemTypes = getRandomInt(1, 3); // drastically reduce items for quicker calculation
            const menuCopy = [...menuItems]; 

            for (let i = 0; i < numItemTypes; i++) {
                const itemIndex = getRandomInt(0, menuCopy.length - 1);
                // Ensure we get a valid item, even if menuCopy runs out
                const item = menuCopy.splice(itemIndex, 1)[0] || menuItems[i % menuItems.length]; 
                const quantity = getRandomInt(1, 2);
                const lineTotal = (item.price * quantity);
                subtotal += lineTotal;
            }

            // Calculate fees and final total (keeping these calculations hidden but accurate)
            const tax = subtotal * taxRate;
            const serviceFee = parseFloat(getRandomFloat(1.5, 3.5));
            const deliveryFee = 0.00; 
            const customerTip = parseFloat(getRandomFloat(2.00, 5.00));
            const total = subtotal + tax + serviceFee + deliveryFee + customerTip;

            const divider = "----------------------------------------";
            
            // Format the address for BIG LETTERS on the receipt
            const addressDisplay = deliveryAddress 
                ? `<div style="text-align: center; margin: 15px 0; padding: 5px; border-bottom: 1px dashed black; border-top: 1px dashed black;">
                      <p style="font-size: 16px; font-weight: bold; line-height: 1.2;">DELIVERY TO:</p>
                      <p style="font-size: 18px; font-weight: 700; line-height: 1.2; word-wrap: break-word;">${deliveryAddress.toUpperCase()}</p>
                   </div>
                   <p>${divider}</p>`
                : `<div style="text-align: center; margin: 15px 0; padding: 5px; border-bottom: 1px dashed black; border-top: 1px dashed black;">
                      <p style="font-size: 14px; color: #cc0000; font-weight: bold;">[NO DELIVERY ADDRESS SAVED]</p>
                   </div>
                   <p>${divider}</p>`;


            let receiptHTML = `
                <!-- Minimal Header -->
                <div style="text-align: center; margin-bottom: 10px;">
                    <span style="font-size: 14px; font-weight: bold;">U B E R &nbsp; E A T S</span><br>
                </div>

                <!-- Delivery Address -->
                ${addressDisplay}
                
                <!-- Restaurant Name -->
                <div style="text-align: center; font-size: 16px; font-weight: bold; margin-bottom: 15px;">
                    ${restaurantName.toUpperCase()}
                </div>

                <p>${divider}</p>
                
                <!-- Final Total -->
                <div style="font-size: 13px; font-weight: bold; margin: 15px 0;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>TOTAL CHARGED</span>
                        <span>$${total.toFixed(2)}</span>
                    </div>
                </div>

                <p>${divider}</p>

                <!-- Minimal Footer -->
                <div style="text-align: center; font-size: 9px; margin-top: 10px;">
                    <p>Order processed through Uber Eats Platform.</p>
                    <p style="margin-top: 5px;">&copy; 2025 Uber Technologies Inc.</p>
                </div>
            `;
            return receiptHTML;
        }

        /**
         * Handles the button click: generates receipt, injects HTML, and prints.
         */
        function handleSelection(restaurantName) {
            
            // CRITICAL CHECK: Ensure there is at least one address to pick from.
            if (addresses.length === 0) {
                 showTemporaryMessage("Error: You must save at least one delivery address in the manager section (1.) before generating an order. Please add one!", 'text-red-800 border-red-400 bg-red-100');
                 return;
            }

            // Randomly select an address from the saved list
            const randomAddress = getRandomElement(addresses);
            const deliveryAddressText = randomAddress.text;
            
            // 1. Generate receipt content
            const receiptHTML = generateReceipt(restaurantName, deliveryAddressText);
            
            // 2. Inject into the hidden container
            document.getElementById('receipt-content').innerHTML = receiptHTML;

            // 3. Trigger the print dialog
            window.print();
        }

        // Initialize on load: Load addresses and custom restaurants, then update selection buttons
        window.onload = function() {
            loadAddresses();
            loadCustomRestaurants();
            // generateNameOptions() is called inside loadCustomRestaurants()
        };
    </script>
</body>
</html>
